<!DOCTYPE html>


<!--
 | Generated by Apache Maven Doxia Site Renderer 1.11.1 from src/site/asciidoc/examples/test-resources.adoc at 2023-05-17
 | Rendered using Apache Maven Fluido Skin 1.11.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.11.1" />
    <title>Micronaut Maven Plugin - Plugin &#x2013; </title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.11.1.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script src="../js/apache-maven-fluido-1.11.1.min.js"></script>
    <style>.github-fork-ribbon:before { background-color: black; }</style>
  </head>
  <body class="topBarEnabled">
    <a class="github-fork-ribbon right-top" href="https://github.com/micronaut-projects/micronaut-maven-plugin" data-ribbon="Fork me on GitHub" title="Fork me on GitHub">Fork me on GitHub</a>
    <header id="topbar" class="navbar navbar-fixed-top ">
      <div class="navbar-inner">
            <div class="container">
              <a data-target=".nav-collapse" data-toggle="collapse" class="btn btn-navbar">
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
              </a>
          <nav class="nav-collapse">
<a class="brand" href="../index.html"  title="Micronaut Logo"><img src="https://micronaut.io/wp-content/uploads/2021/10/favicon-16x16-1.png" alt="Micronaut Logo" />
</a>
            <ul class="nav">
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Overview <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../index.html" title="Introduction">Introduction</a></li>
            <li><a href="../plugin-info.html" title="Goals">Goals</a></li>
            <li><a href="../release-history.html" title="Release History">Release History</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Examples <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../examples/run.html" title="Running in development mode">Running in development mode</a></li>
            <li><a href="../examples/package.html" title="Packaging">Packaging</a></li>
            <li><a href="../dockerfile-mojo.html" title="Generating Dockerfiles">Generating Dockerfiles</a></li>
            <li><a href="../examples/deploy.html" title="Deploying Docker images">Deploying Docker images</a></li>
            <li><a href="../examples/aot.html" title="Using Micronaut AOT">Using Micronaut AOT</a></li>
            <li><a title="Integration with Micronaut Test Resources">Integration with Micronaut Test Resources</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown">Project Documentation <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li class="dropdown-submenu">
<a href="../project-info.html" title="Project Information">Project Information</a>
              <ul class="dropdown-menu">
                  <li><a href="../ci-management.html" title="CI Management">CI Management</a></li>
                  <li><a href="../dependencies.html" title="Dependencies">Dependencies</a></li>
                  <li><a href="../dependency-info.html" title="Dependency Information">Dependency Information</a></li>
                  <li><a href="../issue-management.html" title="Issue Management">Issue Management</a></li>
                  <li><a href="../licenses.html" title="Licenses">Licenses</a></li>
                  <li><a href="../plugin-management.html" title="Plugin Management">Plugin Management</a></li>
                  <li><a href="../plugins.html" title="Plugins">Plugins</a></li>
                  <li><a href="../scm.html" title="Source Code Management">Source Code Management</a></li>
                  <li><a href="../summary.html" title="Summary">Summary</a></li>
                  <li><a href="../team.html" title="Team">Team</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
<a href="../project-reports.html" title="Project Reports">Project Reports</a>
              <ul class="dropdown-menu">
                  <li><a href="../plugin-info.html" title="Plugin Documentation">Plugin Documentation</a></li>
                  <li><a href="../apidocs/index.html" title="Javadoc">Javadoc</a></li>
                  <li><a href="../checkstyle.html" title="Checkstyle">Checkstyle</a></li>
              </ul>
            </li>
        </ul>
      </li>
            </ul>
          </nav>
          <div class="nav-collapse">
<form id="search-form" action="https://www.google.com/search" method="get"  class="navbar-search pull-right" >
  <input value="github.com/micronaut-projects/micronaut-maven-plugin/micronaut-maven-plugin" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" placeholder="Search with Google..." />
</form>
    <ul class="nav pull-right" style="border:none; margin-top: 7px"><li>
    <a href="https://twitter.com/micronautfw" class="twitter-follow-button" data-show-count="true" data-align="right" data-size="large" data-show-screen-name="true" data-lang="en">Follow micronautfw</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
    </li></ul>
            <ul class="nav pull-right">
              <li class="dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown">External Links <b class="caret"></b></a>
                <ul class="dropdown-menu">
    <li><a href="https://micronaut.io" title="Micronaut">Micronaut</a></li>
                </ul>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </header>
    <div class="container">
      <header>
        <div id="banner">
          <div class="pull-left"><div id="bannerLeft"><h1>Micronaut Maven Plugin - Plugin</h1>
</div>
</div>
          <div class="pull-right"></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2023-05-17<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 4.0.0-SNAPSHOT</li>
          </ul>
        </div>
      </header>
        <main id="bodyColumn" >
<div class="sect2">
<h3 id="integration_with_micronaut_test_resources">Integration with Micronaut Test Resources</h3>
<div class="paragraph">
<p><a href="https://micronaut-projects.github.io/micronaut-test-resources/latest/guide/index.html">Micronaut Test Resources</a> adds
support for managing external resources which are required during development or testing. In particular, it integrates
with <a href="https://www.testcontainers.org/">Testcontainers</a> to provide throwaway containers for resources like databases or
other external services like Kafka or RabbitMQ.</p>
</div>
<div class="paragraph">
<p>Test resources are handled by a "test resources service" which is a server accepting requests for test resources, which
lifecycle is handled by the Maven plugin. A test resources request is, to simplify, a request to resolve a missing
configuration property. For example, if the kafka.bootstrap-servers property isnâ€™t set, Micronaut will query the test
resources service for the value of this property. This will trigger the creation of a Kafka test container, and the
service will answer with the URI to the bootstrap server.</p>
</div>
<div class="paragraph">
<p>You can enable test resources support simply by setting the property <code>micronaut.test.resources.enabled</code> (either in your
POM or via the command-line).</p>
</div>
<div class="paragraph">
<p>This will be sufficient for most use cases, and Micronaut will automatically start containers, for example, when a
particular property is not present in your configuration and that you run tests (<code>mvn test</code>) or the application in
development mode (<code>mvn mn:run</code>).</p>
</div>
<div class="paragraph">
<p>For example, if the <code>datasources.default.url</code> configuration property is missing, and that your configuration contains:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span style="color:#606">datasources</span>:
  <span style="color:#606">default</span>:
    <span style="color:#606">dialect</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">MYSQL</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then a MySQL database will automatically be started and available for use in your tests: the url, username and password
configuration properties will automatically be injected to your application.</p>
</div>
<div class="paragraph">
<p>Please refer to the <a href="https://micronaut-projects.github.io/micronaut-test-resources/latest/guide/index.html">Micronaut Test
Resources documentation</a> for a list of all supported modules and their configuration options.</p>
</div>
<div class="sect3">
<h4 id="standalone_test_resource_service">Standalone Test Resource Service</h4>
<div class="paragraph">
<p>The default behaviour works particularly well in single-module projects, or in multi-module projects where test resources
are not shared between modules. However, in some cases, you may want to reuse test containers for multiple projects of
the same multi-project build, in order to save startup times for example.</p>
</div>
<div class="paragraph">
<p>For example, imagine a multi-project build which consists of :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A Kafka consumer.</p>
</li>
<li>
<p>A Kafka producer.</p>
</li>
<li>
<p>Functional tests integrating both.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If each project enables the Test Resources integration independently, then each project will use its own Test Resources
server, separate of the others.</p>
</div>
<div class="paragraph">
<p>However, you might want to run the consumer in one terminal, and the producer in another, and still want them to talk to
the same Kafka cluster. For this you can use a shared test server, by passing the <code>micronaut.test.resources.shared</code>
system property, or setting <code>&lt;shared&gt;true&lt;shared&gt;</code> in the Micronaut Maven Plugin configuration.</p>
</div>
</div>
<div class="sect3">
<h4 id="test_resource_service_lifecycle">Test Resource Service lifecycle</h4>
<div class="paragraph">
<p>Test resources are handled by a service which is, by default, started at the beginning of a build, and stopped at the end.</p>
</div>
<div class="paragraph">
<p>For example, if you invoke:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ mvn test</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then the test resources service will be started before tests are executed, then tests will share the resources provided
by the service. Any test resource started during the test will be stopped when the build finishes.</p>
</div>
<div class="paragraph">
<p>In development mode, the test resources service is also started in the same JVM. For example, if you run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ mvn mn:run</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then the test resources will be spawned before the application starts, and shutdown when you Ctrl+C the <code>mn:run</code>
execution.</p>
</div>
</div>
<div class="sect3">
<h4 id="keeping_the_test_resources_service_alive">Keeping the Test Resources Service alive</h4>
<div class="paragraph">
<p>If you want to start the test resources service in the background, and keep it alive for multiple, independent builds
(different invocations on the command line for example), you can run the <code>mn:start-testresources-service</code> goal:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ mvn mn:start-testresources-service
[INFO] Scanning for projects...
[INFO]
[INFO] --------------------------&lt; com.example:demo &gt;--------------------------
[INFO] Building demo 0.1
[INFO] --------------------------------[ jar ]---------------------------------
[INFO]
[INFO] --- mn:4.0.0:start-testresources-service (default-cli) @ demo ---
[INFO] Server settings found in /private/tmp/demo/target/../.micronaut/test-resources
[INFO] Starting Micronaut Test Resources server
18:37:31.043 [ForkJoinPool.commonPool-worker-13] INFO  i.m.t.e.TestResourcesResolverLoader - Loaded 2 test resources resolvers: io.micronaut.testresources.mysql.MySQLTestResourceProvider, io.micronaut.testresources.testcontainers.GenericTestContainerProvider
18:37:31.290 [main] INFO  i.m.testresources.server.Application - A Micronaut Test Resources server is listening on port 51082, started in 387ms
[INFO] Micronaut Test Resources service is started in the background. To stop it, run the following command: 'mvn mn:stop-testresources-service'
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  1.813 s
[INFO] Finished at: 2022-07-08T18:37:31+02:00
[INFO] ------------------------------------------------------------------------</code></pre>
</div>
</div>
<div class="paragraph">
<p>To stop it, use the <code>mn:stop-testresources-service</code> goal.</p>
</div>
</div>
<div class="sect3">
<h4 id="adding_modules_or_libraries_to_the_test_resources_service_classpath">Adding modules or libraries to the Test Resources service classpath</h4>
<div class="paragraph">
<p>If not using classpath inference, or when the inference doesn&#8217;t produce the desired result, you can add dependencies
to the Test Resources service classpath with a <code>&lt;testResourcesDependencies&gt;</code> block.</p>
</div>
<div class="paragraph">
<p>For example, if the classpath inference mechanism fails to detect that you need a MySQL test container, you can configure
it like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;build&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;plugins&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;plugin&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>io.micronaut.maven<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>micronaut-maven-plugin<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;configuration&gt;</span>
                <span style="color:#070;font-weight:bold">&lt;classpathInference&gt;</span>false<span style="color:#070;font-weight:bold">&lt;/classpathInference&gt;</span>
                <span style="color:#070;font-weight:bold">&lt;testResourcesDependencies&gt;</span>
                    <span style="color:#070;font-weight:bold">&lt;dependency&gt;</span>
                        <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>io.micronaut.testresources<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
                        <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>micronaut-test-resources-jdbc-mysql<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
                    <span style="color:#070;font-weight:bold">&lt;/dependency&gt;</span>
                    <span style="color:#070;font-weight:bold">&lt;dependency&gt;</span>
                        <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>mysql<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
                        <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>mysql-connector-java<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
                    <span style="color:#070;font-weight:bold">&lt;/dependency&gt;</span>
                <span style="color:#070;font-weight:bold">&lt;/testResourcesDependencies&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;/configuration&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;/plugin&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/plugins&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/build&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The versions of those dependencies will be resolved against the Micronaut BOM.</p>
</div>
<div class="paragraph">
<p>The list of supported modules is described in the
<a href="https://micronaut-projects.github.io/micronaut-test-resources/latest/guide/#modules">Micronaut Test Resources documentation</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="additional_configuration_options">Additional configuration options</h4>
<div class="paragraph">
<p>You can see all the additional configuration options in the
<a href="../start-testresources-service-mojo.html"><code>start-testresources-service</code> goal documentation</a>.</p>
</div>
</div>
</div>
        </main>
    </div>
    <hr/>
    <footer>
      <div class="container">
        <div class="row">
            <p>&#169;      2020&#x2013;2023
<a href="https://micronaut.io/">Micronaut</a>
</p>
        </div>
        <p id="poweredBy" class="pull-right"><a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" /></a>
</p>
      </div>
    </footer>
<script>
	if(anchors) {
	  anchors.add();
	}
</script>
  </body>
</html>
